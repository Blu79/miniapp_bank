<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Mini Bank App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    .app {
      padding: 16px;
    }
    .card {
      background: rgba(15,23,42,0.9);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      border: 1px solid rgba(148,163,184,0.3);
    }
    .title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .balance {
      font-size: 26px;
      font-weight: 700;
      margin: 8px 0;
      color: #22c55e;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    .pill {
      flex: 1;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 13px;
      text-align: center;
      background: rgba(30,64,175,0.7);
      color: #e5e7eb;
      border: 1px solid rgba(191,219,254,0.2);
      cursor: pointer;
      user-select: none;
    }
    .pill.secondary {
      background: rgba(15,23,42,0.8);
      border-color: rgba(148,163,184,0.4);
    }
    .pill:active {
      transform: scale(0.98);
      opacity: 0.8;
    }
    .label {
      font-size: 13px;
      color: #9ca3af;
    }
    .value {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin: 12px 0 6px;
    }
    .tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(56,189,248,0.15);
      border: 1px solid rgba(56,189,248,0.5);
      color: #7dd3fc;
      margin-right: 4px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
<div class="app">
  <div class="card">
    <div class="title">Mini Bank App üí≥</div>
    <div class="subtitle" id="subtitle">ƒêang t·∫£i th√¥ng tin Telegram...</div>

    <div class="label">S·ªë d∆∞ ∆∞·ªõc t√≠nh</div>
    <div class="balance" id="balance">0 ƒë</div>

    <div class="row">
      <div class="pill" id="btnOpenBot">
        üîÅ M·ªü bot chat
      </div>
      <div class="pill secondary" id="btnCopyRef">
        üë• Copy link m·ªùi
      </div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">Tr·∫°ng th√°i t√†i kho·∫£n</div>
    <div class="label">User</div>
    <div class="value" id="userInfo">Kh√¥ng x√°c ƒë·ªãnh</div>

    <div class="label">Th√¥ng tin kh√°c</div>
    <div class="tag">ƒêi·ªÉm danh m·ªói ng√†y üéØ</div>
    <div class="tag">L√†m nhi·ªám v·ª• üßæ</div>
    <div class="tag">M·ªùi b·∫°n b√® üë•</div>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand(); // m·ªü r·ªông full m√†n h√¨nh

  // L·∫•y th√¥ng tin user t·ª´ WebApp
  let user = tg.initDataUnsafe && tg.initDataUnsafe.user;

  const subtitleEl = document.getElementById("subtitle");
  const balanceEl = document.getElementById("balance");
  const userInfoEl = document.getElementById("userInfo");
  const btnOpenBot = document.getElementById("btnOpenBot");
  const btnCopyRef = document.getElementById("btnCopyRef");

  // Hi·ªÉn th·ªã th√¥ng tin c∆° b·∫£n
  if (user) {
    const fullName = [user.first_name, user.last_name].filter(Boolean).join(" ");
    const username = user.username ? "@" + user.username : "kh√¥ng c√≥ username";
    subtitleEl.textContent = `Xin ch√†o, ${fullName}!`;
    userInfoEl.textContent = `${fullName} ‚Ä¢ ID ${user.id} ‚Ä¢ ${username}`;
  } else {
    subtitleEl.textContent = "Kh√¥ng l·∫•y ƒë∆∞·ª£c th√¥ng tin user t·ª´ Telegram WebApp.";
    userInfoEl.textContent = "Vui l√≤ng m·ªü Mini App t·ª´ trong bot.";
  }

  // ‚ö†Ô∏è ·ªû ƒë√¢y m√¨nh ch·ªâ hi·ªÉn th·ªã S·ªê D∆Ø GI·∫¢ (demo)
  // Th·ª±c t·∫ø b·∫°n n√™n g·ªçi API backend c·ªßa b·∫°n ƒë·ªÉ tr·∫£ v·ªÅ s·ªë d∆∞ th·∫≠t.
  // V√≠ d·ª•: fetch('/api/balance?user_id=' + user.id)...
  balanceEl.textContent = "ƒêang t·∫£i...";

  // Demo: gi·∫£ l·∫≠p fetch s·ªë d∆∞
  setTimeout(() => {
    // TODO: thay b·∫±ng s·ªë d∆∞ th·∫≠t t·ª´ server
    const fakeBalance = 123456; 
    balanceEl.textContent = fakeBalance.toLocaleString("vi-VN") + " ƒë";
  }, 700);

  // N√∫t m·ªü l·∫°i bot chat
  btnOpenBot.addEventListener("click", () => {
    tg.close(); // ƒë√≥ng WebApp ƒë·ªÉ quay l·∫°i bot
  });

  // N√∫t copy link m·ªùi
  btnCopyRef.addEventListener("click", async () => {
    if (!user) {
      tg.showAlert("Kh√¥ng l·∫•y ƒë∆∞·ª£c ID user.");
      return;
    }
    const botUsername = tg.initDataUnsafe && tg.initDataUnsafe.receiver && tg.initDataUnsafe.receiver.username;
    // N·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c t·ª´ initData, b·∫°n c√≥ th·ªÉ hardcode t√™n bot:
    const finalBotUsername = botUsername || "TenBotCuaBan";
    const refLink = `https://t.me/${finalBotUsername}?start=${user.id}`;

    try {
      await navigator.clipboard.writeText(refLink);
      tg.showPopup({
        title: "ƒê√£ copy!",
        message: "Link m·ªùi ƒë√£ ƒë∆∞·ª£c sao ch√©p, h√£y d√°n v√† g·ª≠i cho b·∫°n b√®.",
        buttons: [{id: "ok", type: "default", text: "OK"}]
      });
    } catch (e) {
      tg.showAlert("Kh√¥ng copy ƒë∆∞·ª£c, vui l√≤ng copy tay:\n" + refLink);
    }
  });
</script>
</body>
</html>

